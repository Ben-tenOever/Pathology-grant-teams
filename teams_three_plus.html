<!doctype html>
<html lang="en"><head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" /><meta http-equiv="Expires" content="0" />
<title>Pathology Teams of three or more</title><link rel="stylesheet" href="teams.css" />
</head><body>
<div class="container" style="max-width:1100px; margin:0 auto; padding:18px 16px;">
  <div style="display:flex; gap:14px; flex-wrap:wrap; align-items:baseline;">
    <a href="index.html" style="text-decoration:none;">Home</a>
    <a href="faculty.html" style="text-decoration:none;">Faculty profiles</a>
    <a href="teams_two.html" style="text-decoration:none;">Pairs</a>
    <a href="teams_three_plus.html" style="text-decoration:none;">Teams of three or more</a>
    <a href="resources.html" style="text-decoration:none;">Resources and model systems</a>
    <a href="approaches.html" style="text-decoration:none;">Experimental approaches</a>
  </div>
</div>
<main id="app"><div class="container" style="max-width:1100px; margin:0 auto; padding:24px 16px;">Loadingâ€¦</div></main>
<script>
(function () {
  var app = document.getElementById("app");
  function esc(s) {
    s = String(s == null ? "" : s);
    return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
  }
  function loadJson(path, cb) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", path + "?cb=" + Date.now(), true);
    xhr.onreadystatechange = function () {
      if (xhr.readyState !== 4) return;
      if (xhr.status < 200 || xhr.status >= 300) return cb(new Error("Failed to load " + path + " status " + xhr.status));
      try { cb(null, JSON.parse(xhr.responseText)); }
      catch (e) { cb(new Error("JSON parse error for " + path + ": " + e)); }
    };
    xhr.onerror = function () { cb(new Error("Network error loading " + path)); };
    xhr.send(null);
  }

  function splitNames(v) {
    if (v == null) return [];
    if (Array.isArray(v)) return v;
    return String(v).split(/[\n,;|]+/g).map(function(x){return x.trim();}).filter(Boolean);
  }

  function membersOf(t) {
    if (Array.isArray(t.members)) return t.members;
    if (t.team_members) return splitNames(t.team_members);
    if (t.team_members && typeof t.team_members === "string") return splitNames(t.team_members);
    if (t.team_members) return splitNames(t.team_members);
    return [];
  }

  loadJson("data/faculty_index.json", function(err1, faculty) {
    if (err1) { app.innerHTML = '<pre style="white-space:pre-wrap; padding:16px;">' + esc(String(err1)) + '</pre>'; return; }
    loadJson("data/teams.json", function(err2, teams) {
      if (err2) { app.innerHTML = '<pre style="white-space:pre-wrap; padding:16px;">' + esc(String(err2)) + '</pre>'; return; }

      faculty = faculty || [];
      teams = teams || [];
      var idByName = {};
      for (var i=0;i<faculty.length;i++) idByName[String(faculty[i].name||"").toLowerCase()] = faculty[i].id;

      function memberLink(name) {
        var fid = idByName[String(name||"").toLowerCase()] || "";
        return fid ? '<a href="profile.html?id=' + encodeURIComponent(fid) + '" style="text-decoration:none;">' + esc(name) + '</a>' : esc(name);
      }

      function isPair(t) {
        var tt = String(t.team_type || t.team_size_category || "").toLowerCase();
        if (tt === "pair") return true;
        return membersOf(t).length === 2;
      }

      function isThreePlus(t) {
        var tt = String(t.team_type || t.team_size_category || "").toLowerCase();
        if (tt === "team") return true;
        return membersOf(t).length >= 3;
      }

      var keep = [];
      for (var k=0;k<teams.length;k++) {
        var t = teams[k] || {};
        if ("team" === "pair" && isPair(t)) keep.push(t);
        if ("team" === "team" && isThreePlus(t)) keep.push(t);
      }

      var html = '<div class="container" style="max-width:1100px; margin:0 auto; padding:24px 16px;">';
      html += '<h1 style="margin:0;">Teams of three or more</h1><div style="opacity:.85; margin-top:6px;">Pathology</div>';
      html += '<div style="opacity:.75; margin-top:6px;">Found: ' + keep.length + '</div>';
      html += '<div style="margin-top:16px; display:flex; flex-direction:column; gap:12px;">';

      for (var p=0;p<keep.length;p++) {
        var t2 = keep[p] || {};
        var m = membersOf(t2);
        var mhtml = m.map(memberLink).join(", ");
        html += '<div class="card" style="padding:16px;">';
        html += '<div style="font-weight:700; font-size:1.05rem;">' + esc(t2.team_name || t2.proposed_title || "") + '</div>';
        html += '<div style="opacity:.85; margin-top:6px;">' + mhtml + '</div>';
        if (t2.opportunity_title) html += '<div style="margin-top:10px; opacity:.9;">Opportunity: ' + esc(t2.opportunity_title) + '</div>';
        if (t2.rationale) html += '<div style="margin-top:10px; opacity:.9;">' + esc(t2.rationale) + '</div>';
        html += '</div>';
      }

      html += '</div></div>';
      app.innerHTML = html;
    });
  });
})();
</script>
</body></html>
